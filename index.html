<!DOCTYPE html><html><head><title>js13kgame</title><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta charset="utf-8"></head><style>body,html{display:block;height:100%;overflow:hidden;background-color:#222;color:#F5F5F5}canvas{border:1px solid #444;position:absolute;top:10%;left:10%;margin:0;padding:0;box-sizing:border-box}.entityList{height:50px;width:100px;overflow-y:scroll}</style><body><form id="formInput" change="false">Gravity: <input id="gravityInput" value="1" type="number">Pause: <input id="pauseCheckbox" value="false" type="checkbox">Entities:<select id="entityList"></select>X: <input id="xInput" value="0" type="number">Y: <input id="yInput" value="0" type="number">Width: <input id="widthInput" value="0" type="number">Height: <input id="heightInput" value="0" type="number">IsMovable: <input id="isMovableCheckbox" value="false" type="checkbox">Collider: <input id="colliderCheckbox" value="false" type="checkbox"></form></body><script>"use strict";!function(){var e=function(e,t){return{entities:e,gravity:t,movableEntities:e.filter(function(e){return e.isMovable}),playerEntity:e.find(function(e){return e.isPlayer}),pause:!1}},t=function(e,t,i,n,o,r,a,c,l,d,u,h,s,v,f,y,g,m,E){return{x:e,y:t,width:i,height:n,velX:o,velY:r,collisionFactorX:a,collisionFactorY:c,forme:l,color:d,isStatic:u,isMovable:h,isPlayer:s,isKiller:v,isFinisher:f,childFactory:E,collider:y,inConsole:g,isSelected:m,isKilled:!1,canJump:!1}},i={RECT:0,CIRCLE:1,TRIANGLE:2,TRIANGLE_DOWN:3},n=!0,o=function(e,t,n){var o=r(e,n);n.isSelected?t.fillStyle="blue":t.fillStyle=n.color,t.beginPath(),n.forme===i.RECT?t.rect(o.x,o.y,o.width,o.height):n.forme===i.CIRCLE?t.arc(o.x+o.width/2,o.y+o.height/2,o.width/2,0,2*Math.PI):n.forme===i.TRIANGLE?(t.moveTo(o.x+o.width/2,o.y),t.lineTo(o.x+o.width,o.y+o.height),t.lineTo(o.x,o.y+o.height)):n.forme===i.TRIANGLE_DOWN&&(t.moveTo(o.x,o.y),t.lineTo(o.x+o.width,o.y),t.lineTo(o.x+o.width/2,o.y+o.height)),t.closePath(),t.fill()},r=function(e,t){return{x:t.x*e.width/100,y:t.y*e.height/100,width:t.width*e.width/100,height:t.height*e.height/100}},a=function(e,t){var i=e.getContext("2d");i.clearRect(0,0,e.width,e.height),t.forEach(function(t){return o(e,i,t)})},c={init:function(){n=!0},render:function(e){n&&(n=!1,a(l,e.entities.filter(function(e){return e.isStatic}))),a(d,e.entities.filter(function(e){return!e.isStatic}))}},l=document.createElement("canvas");l.width=.8*window.innerWidth,l.height=.8*window.innerHeight,document.getElementsByTagName("body")[0].appendChild(l);var d=document.createElement("canvas");d.width=.8*window.innerWidth,d.height=.8*window.innerHeight,document.getElementsByTagName("body")[0].appendChild(d),window.addEventListener("resize",function(){l.width=.8*window.innerWidth,l.height=.8*window.innerHeight,d.width=.8*window.innerWidth,d.height=.8*window.innerHeight,n=!0},!1);var u=0,h=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),n=i.exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},s={level:function(){var e=h("map"),t=h("gravity");return v(e&&t?[parseFloat(t),e]:f[u])},next:function(){u<f.length-1?u++:window.alert("win")},previous:function(){u>0&&u--}},v=function(n){var o=n[1].split("|"),r=o.map(function(e){var n=e.split(",");switch(n[0]){case"J":return t(+n[1],+n[2],2,2,0,0,0,0,i.CIRCLE,"red",!1,!0,!0,!1,!1,!0,!1,!1);case"M":return t(+n[1],+n[2],+n[3],+n[4],0,0,0,-.1,i.RECT,"grey",!0,!1,!1,!1,!1,!1,!1,!1);case"T":return t(+n[1],+n[2],+n[3],+n[4],0,0,0,-.5,i.RECT,"blue",!0,!1,!1,!1,!1,!1,!1,!1);case"T_C":return t(+n[1],+n[2],+n[3],+n[4],0,0,0,-.5,i.RECT,"violet",!1,!0,!1,!1,!1,!0,!1,!1);case"G":return t(+n[1],+n[2],3,5,0,0,0,0,i.RECT,"violet",!0,!1,!1,!1,!0,!1,!1,!1);case"F":return t(+n[1],+n[2],+n[3],+n[4],0,0,0,0,i.TRIANGLE_DOWN,"orange",!1,!1,!1,!0,!1,!1,!1,!1);case"A":return t(+n[1],+n[2],2,2,0,0,0,0,i.CIRCLE,"pink",!0,!1,!1,!0,!1,!1,!1,!1,function(){return t(50,50,.5,.5,0,0,0,0,i.CIRCLE,"pink",!1,!0,!1,!0,!1,!1)})}});return e(r,n[0])},f=[[1,"J,10,10|T,0,90,90,2|G,90,90|A,50,50"],[1,"J,10,10|T,0,50,80,2|M,50,10,2,40|G,70,45|F,10,0,20,5|F,30,0,10,8|F,40,0,5,3|F,45,0,10,3|F,55,0,10,5"],[1,"J,50,10|T,0,90,95,2|G,90,5|F,55,0,10,10"]],y=0,g=function(e,t){if(y!==t.selectedIndex)if(0!==y&&(e.entities[y-1].isSelected=!1),y=t.selectedIndex,0===y)m(0,0,0,0,!1,!1);else{var i=e.entities[y-1];i.isSelected=!0,m(i.x,i.y,i.width,i.height,i.isMovable,i.collider)}},m=function(e,t,i,n,o,r){document.getElementById("xInput").value=e,document.getElementById("yInput").value=t,document.getElementById("widthInput").value=i,document.getElementById("heightInput").value=n,document.getElementById("isMovableCheckbox").checked=o,document.getElementById("colliderCheckbox").checked=r},E=function(e){var t=parseFloat(document.getElementById("gravityInput").value);isNaN(t)||e.gravity===t||(e.gravity=t);var i=document.getElementById("pauseCheckbox").checked;e.pause!==i&&(e.pause=i);var n=document.getElementById("entityList");if(g(e,n),0!==n.selectedIndex){var o=e.entities[n.selectedIndex-1];if(o.isSelected){var r=parseFloat(document.getElementById("xInput").value),a=parseFloat(document.getElementById("yInput").value),c=parseFloat(document.getElementById("widthInput").value),l=parseFloat(document.getElementById("heightInput").value),d=document.getElementById("isMovableCheckbox").checked,u=document.getElementById("colliderCheckbox").checked;if(r!==o.x&&(o.x=r),a!==o.y&&(o.y=a),c!==o.width&&(o.width=c),l!==o.height&&(o.height=l),d!==o.isMovable)if(console.log("oh"),o.isMovable=d,d)e.movableEntities.push(o);else for(var h=0;h<e.movableEntities.length;h++)e.movableEntities[h]===o&&e.movableEntities.splice(h,1);u!==o.collider&&(o.collider=u)}}},w={init:function(e){for(var t=0,i=document.getElementById("entityList"),n=i.length;n>=0;n--)i.remove(n);var o=document.createElement("option");o.text="",i.add(o),e.entities.forEach(function(){var e=document.createElement("option");e.text=t,i.add(e),t++}),y=0,m(0,0,0,0,!1,!1),E(e)},run:function(e){E(e)}},p={update:function(e,t){e.movableEntities.forEach(function(i){i.x+=t*i.velX,i.velX=0,i.y+=t*i.velY,i.velY+=e.gravity})}},x=0,I=1,b=2,C=3,F=function(e,t){var i=!(e.x>=t.x+t.width||e.x+e.width<=t.x||e.y>=t.y+t.height||e.y+e.height<=t.y);if(i){var n=Math.abs(e.x-(t.x+t.width)),o=Math.abs(e.x+e.width-t.x),r=Math.abs(e.y-(t.y+t.height)),a=Math.abs(e.y+e.height-t.y);return n<o&&n<r&&n<a?C:o<r&&o<a?I:r<a?x:b}},T=function(e){return e.x>100||e.x<0||e.y>100||e.y<0},k={check:function(e){var t=!1;return e.playerEntity.canJump=!1,e.entities.forEach(function(i){i.collider&&e.entities.forEach(function(n){if(i!==n){var o=F(i,n);void 0!==o&&(o===b?(i.velX*=n.collisionFactorX*Math.sign(e.gravity),i.velY*=n.collisionFactorY*Math.sign(e.gravity),i.y=n.y-i.height):o===x?(i.velX*=n.collisionFactorX*Math.sign(-e.gravity),i.velY*=n.collisionFactorY*Math.sign(-e.gravity),i.y=n.y+n.height):o===I?i.x=n.x-i.width:o===C&&(i.x=n.x+n.width),i===e.playerEntity&&(o!==I&&o!==C&&n.collisionFactorY<0&&(i.canJump=!0),n.isKiller&&(i.isKilled=!0),t=n.isFinisher))}})}),t},checkGameOver:function(e){var t=e.playerEntity;return t.isKilled||T(t)},garbageOffScreenEntities:function(e){for(var t=!1,i=e.entities.length-1;i>-1;i--){var n=e.entities[i];T(n)&&(e.entities.splice(e.entities.indexOf(n),1),t=!0)}return t}},R=[!1,!1,!1,!1],B=function(e){return function(t){var i=t.keyCode-37;void 0!==R[i]&&(R[i]=e)}};window.addEventListener("keydown",B(!0),!1),window.addEventListener("keyup",B(!1),!1);var M=50,L=-50,N=function(e){var t=e.playerEntity;R[0]?t.velX=-M:R[2]&&(t.velX=M),R[1]&&t.canJump&&(t.velY+=L),R[3]&&t.canJump&&(t.velY-=L)},S=60,G=requestAnimationFrame||function(e){setTimeout(e,1/S*1e3)},Y=0,X=function(e,t,i){var n=0,o=function o(){Y++;var r=Date.now(),a=(r-n)/1e3;if(k.garbageOffScreenEntities(e)&&w.init(e),w.run(e),k.checkGameOver(e)&&n>0)return i();e.pause||(N(e),p.update(e,a));var l=k.check(e);return l?t():(Y%25===0&&e.entities.filter(function(e){return void 0!==e.childFactory}).forEach(function(t){var i=t.childFactory();e.entities.push(i),e.movableEntities.push(i)}),c.render(e),n=r,void G(o))};c.init(),o()},J=function(){s.next(),O()},A=function(){s.previous(),O()},O=function(){var e=s.level();w.init(e),X(e,J,A)};O()}();</script></html>