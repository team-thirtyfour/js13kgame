"use strict";!function(){var e=function(e,t){return{entities:e,gravity:t,movableEntities:e.filter(function(e){return e.isMovable}),playerEntity:e.find(function(e){return e.isPlayer}),pause:!1}},t=function(e,t,i,n,r,o,a,c,l,d,u,h,s,v,y,f,g,m){return{x:e,y:t,width:i,height:n,velX:r,velY:o,collisionFactorX:a,collisionFactorY:c,forme:l,color:d,isMovable:u,isPlayer:h,isKiller:s,isFinisher:v,childFactory:m,collider:y,inConsole:f,isSelected:g,isKilled:!1,canJump:!1}},i={RECT:0,CIRCLE:1,TRIANGLE:2,TRIANGLE_DOWN:3},n=!0,r=function(e,t,n){var r=o(e,n);n.isSelected?t.fillStyle="blue":t.fillStyle=n.color,t.beginPath(),n.forme===i.RECT?t.rect(r.x,r.y,r.width,r.height):n.forme===i.CIRCLE?t.arc(r.x+r.width/2,r.y+r.height/2,r.width/2,0,2*Math.PI):n.forme===i.TRIANGLE?(t.moveTo(r.x+r.width/2,r.y),t.lineTo(r.x+r.width,r.y+r.height),t.lineTo(r.x,r.y+r.height)):n.forme===i.TRIANGLE_DOWN&&(t.moveTo(r.x,r.y),t.lineTo(r.x+r.width,r.y),t.lineTo(r.x+r.width/2,r.y+r.height)),t.closePath(),t.fill()},o=function(e,t){return{x:t.x*e.width/100,y:t.y*e.height/100,width:t.width*e.width/100,height:t.height*e.height/100}},a=function(e,t){var i=e.getContext("2d");i.clearRect(0,0,e.width,e.height),t.forEach(function(t){return r(e,i,t)})},c={init:function(){n=!0},render:function(e){n&&(n=!1,a(l,e.entities.filter(function(e){return!e.isMovable}))),a(d,e.entities.filter(function(e){return e.isMovable}))}},l=document.createElement("canvas");l.width=.8*window.innerWidth,l.height=.8*window.innerHeight,document.getElementsByTagName("body")[0].appendChild(l);var d=document.createElement("canvas");d.width=.8*window.innerWidth,d.height=.8*window.innerHeight,document.getElementsByTagName("body")[0].appendChild(d),window.addEventListener("resize",function(){l.width=.8*window.innerWidth,l.height=.8*window.innerHeight,d.width=.8*window.innerWidth,d.height=.8*window.innerHeight,n=!0},!1);var u=0,h=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),n=i.exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},s={level:function(){var e=h("map"),t=h("gravity");return v(e&&t?[parseFloat(t),e]:y[u])},next:function(){u<y.length-1?u++:window.alert("win")},previous:function(){u>0&&u--}},v=function(n){var r=n[1].split("|"),o=r.map(function(e){var n=e.split(",");switch(n[0]){case"J":return t(+n[1],+n[2],2,2,0,0,0,0,i.CIRCLE,"red",!0,!0,!1,!1,!0,!1,!1);case"M":return t(+n[1],+n[2],+n[3],+n[4],0,0,0,-.1,i.RECT,"grey",!1,!1,!1,!1,!1,!1,!1);case"T":return t(+n[1],+n[2],+n[3],+n[4],0,0,0,-.5,i.RECT,"blue",!1,!1,!1,!1,!1,!1,!1);case"T_C":return t(+n[1],+n[2],+n[3],+n[4],0,0,0,-.5,i.RECT,"violet",!0,!1,!1,!1,!0,!1,!1);case"G":return t(+n[1],+n[2],3,5,0,0,0,0,i.RECT,"violet",!1,!1,!1,!0,!1,!1,!1);case"F":return t(+n[1],+n[2],+n[3],+n[4],0,0,0,0,i.TRIANGLE_DOWN,"orange",!1,!1,!0,!1,!1,!1,!1);case"A":return t(+n[1],+n[2],2,2,0,0,0,0,i.CIRCLE,"pink",!1,!1,!0,!1,!1,!1,!1,function(){return t(50,50,.5,.5,0,0,0,0,i.CIRCLE,"pink",!0,!1,!0,!1,!1)})}});return e(o,n[0])},y=[[1,"J,10,10|T,0,90,90,2|G,90,90|A,50,50"],[1,"J,10,10|T,0,50,80,2|M,50,10,2,40|G,70,45|F,10,0,20,5|F,30,0,10,8|F,40,0,5,3|F,45,0,10,3|F,55,0,10,5"],[1,"J,50,10|T,0,90,95,2|G,90,5|F,55,0,10,10"]],f=0,g=function(e,t){if(f!==t.selectedIndex)if(0!==f&&(e.entities[f-1].isSelected=!1),f=t.selectedIndex,0===f)m(0,0,0,0,!1,!1);else{var i=e.entities[f-1];i.isSelected=!0,m(i.x,i.y,i.width,i.height,i.isMovable,i.collider)}},m=function(e,t,i,n,r,o){document.getElementById("xInput").value=e,document.getElementById("yInput").value=t,document.getElementById("widthInput").value=i,document.getElementById("heightInput").value=n,document.getElementById("isMovableCheckbox").checked=r,document.getElementById("colliderCheckbox").checked=o},w=function(e){var t=parseFloat(document.getElementById("gravityInput").value);isNaN(t)||e.gravity===t||(e.gravity=t);var i=document.getElementById("pauseCheckbox").checked;e.pause!==i&&(e.pause=i);var n=document.getElementById("entityList");if(g(e,n),0!==n.selectedIndex){var r=e.entities[n.selectedIndex-1];if(r.isSelected){var o=parseFloat(document.getElementById("xInput").value),a=parseFloat(document.getElementById("yInput").value),c=parseFloat(document.getElementById("widthInput").value),l=parseFloat(document.getElementById("heightInput").value),d=document.getElementById("isMovableCheckbox").checked,u=document.getElementById("colliderCheckbox").checked;o!==r.x&&(r.x=o),a!==r.y&&(r.y=a),c!==r.width&&(r.width=c),l!==r.height&&(r.height=l),d!==r.isMovable&&(r.isMovable=d),u!==r.collider&&(r.collider=u)}}},E={init:function(e){for(var t=0,i=document.getElementById("entityList"),n=i.length;n>=0;n--)i.remove(n);var r=document.createElement("option");r.text="",i.add(r),e.entities.forEach(function(){var e=document.createElement("option");e.text=t,i.add(e),t++}),f=0,m(0,0,0,0,!1,!1),w(e)},run:function(e){w(e)}},p={update:function(e,t){e.movableEntities.forEach(function(i){i.x+=t*i.velX,i.velX=0,i.y+=t*i.velY,i.velY+=e.gravity})}},x=0,I=1,b=2,C=3,F=function(e,t){var i=!(e.x>=t.x+t.width||e.x+e.width<=t.x||e.y>=t.y+t.height||e.y+e.height<=t.y);if(i){var n=Math.abs(e.x-(t.x+t.width)),r=Math.abs(e.x+e.width-t.x),o=Math.abs(e.y-(t.y+t.height)),a=Math.abs(e.y+e.height-t.y);return n<r&&n<o&&n<a?C:r<o&&r<a?I:o<a?x:b}},T=function(e){return e.x>100||e.x<0||e.y>100||e.y<0},M={check:function(e){var t=!1;return e.playerEntity.canJump=!1,e.entities.forEach(function(i){i.collider&&e.entities.forEach(function(n){if(i!==n){var r=F(i,n);void 0!==r&&(r===b?(i.velX*=n.collisionFactorX*Math.sign(e.gravity),i.velY*=n.collisionFactorY*Math.sign(e.gravity),i.y=n.y-i.height):r===x?(i.velX*=n.collisionFactorX*Math.sign(-e.gravity),i.velY*=n.collisionFactorY*Math.sign(-e.gravity),i.y=n.y+n.height):r===I?i.x=n.x-i.width:r===C&&(i.x=n.x+n.width),i===e.playerEntity&&(r!==I&&r!==C&&n.collisionFactorY<0&&(i.canJump=!0),n.isKiller&&(i.isKilled=!0),t=n.isFinisher))}})}),t},checkGameOver:function(e){var t=e.playerEntity;return t.isKilled||T(t)},garbageOffScreenEntities:function(e){for(var t=!1,i=e.entities.length-1;i>-1;i--){var n=e.entities[i];T(n)&&(e.entities.splice(e.entities.indexOf(n),1),t=!0)}return t}},k=[!1,!1,!1,!1],R=function(e){return function(t){var i=t.keyCode-37;void 0!==k[i]&&(k[i]=e)}};window.addEventListener("keydown",R(!0),!1),window.addEventListener("keyup",R(!1),!1);var B=50,L=-50,N=function(e){var t=e.playerEntity;k[0]?t.velX=-B:k[2]&&(t.velX=B),k[1]&&t.canJump&&(t.velY+=L),k[3]&&t.canJump&&(t.velY-=L)},G=60,Y=requestAnimationFrame||function(e){setTimeout(e,1/G*1e3)},X=0,J=function(e,t,i){var n=0,r=function r(){X++;var o=Date.now(),a=(o-n)/1e3;if(M.garbageOffScreenEntities(e)&&E.init(e),E.run(e),M.checkGameOver(e)&&n>0)return i();e.pause||(N(e),p.update(e,a));var l=M.check(e);return l?t():(X%25===0&&e.entities.filter(function(e){return void 0!==e.childFactory}).forEach(function(t){var i=t.childFactory();e.entities.push(i),e.movableEntities.push(i)}),c.render(e),n=o,void Y(r))};c.init(),r()},S=function(){s.next(),O()},A=function(){s.previous(),O()},O=function(){var e=s.level();E.init(e),J(e,S,A)};O()}();